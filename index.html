<!DOCTYPE html>
<html>
    <body>
        <label for="bar_selection">Bar: </label>
        <select name="bar_selection" id="bar_selection" onchange="selected_option('bar')"></select>
        <button onclick="add_option('bar')">+</button>
        <button onclick="rename_option('bar')">I</button>
        <button onclick="revalue_option('bar')">âœŽ</button>
        <button onclick="delete_option('bar')">ðŸ—‘</button>
        <br/>
        <label for="plates_selection">Plates: </label>
        <select name="plates_selection" id="plates_selection" onchange="selected_option('plates')"></select>
        <button onclick="add_option('plates')">+</button>
        <button onclick="rename_option('plates')">I</button>
        <button onclick="revalue_option('plates')">âœŽ</button>
        <button onclick="delete_option('plates')">ðŸ—‘</button>
        <br/>
        <label for="desired_weight">Desired weight: </label>
        <input name="desired_weight" id="desired_weight"/>
        <br/>
        <button onclick="calculate_desired_weight()">Calculate</button>
        <br/>
        <span id="plates_needed"></span>
        <style>
h2 {
    font-size: medium;
}
body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: lightcoral;
}
        </style>
        <script>
// TODO:

function add_option(dropdown) {
    let response = prompt("Enter name of new " + dropdown, dropdown);
    if (response != null && response != "" && response != dropdown && response != "Courses" && !(response in Object.keys(contents[dropdown]))) {
        contents[dropdown][response] = ["25 lbs", ["45 lbs", "25 lbs", "10 lbs", "5 lbs", "2.5 lbs"]][["bar","plates"].indexOf(dropdown)];
        active_indexes[dropdown] = contents[dropdown].length-1;
        [bar_dropdown, plates_dropdown][["bar","plates"].indexOf(dropdown)].selectedIndex = active_indexes[dropdown];
        refresh_dropdowns();
    }
}

function rename_option(dropdown) {
    console.log("rename_option(" + dropdown + ")");
    return "rename_option(" + dropdown + ")";
    // Code from my work project that needs work to make compatable:
    let response = prompt("Enter new name of course", course_name);
    if (response != null && response != "" && response != "Lesson Title" && !(contents["Courses"].includes(response))) {
        contents["Courses"][course_index] = response;
        contents[response] = contents[course_name];
        delete contents[course_name];
        course_name = response;
        refresh_dropdowns();
    }
}

function revalue_option(dropdown) {
    console.log("revalue_option(" + dropdown + ")");
    return "revalue_option(" + dropdown + ")";
    // Same code as rename:
    let response = prompt("Enter new name of course", course_name);
    if (response != null && response != "" && response != "Lesson Title" && !(contents["Courses"].includes(response))) {
        contents["Courses"][course_index] = response;
        contents[response] = contents[course_name];
        delete contents[course_name];
        course_name = response;
        refresh_dropdowns();
    }
}

function delete_option(dropdown) {
    console.log("delete_option(" + dropdown + ")");
    return "delete_option(" + dropdown + ")";
    // Code from my work project that needs work to make compatable:
    if (contents[course_name] > 0) {
        let certain = confirm("Are you sure you want to delete ALL data for this course?");
        if (certain) {
            contents["Courses"].splice(course_index, 1);
            delete contents[course_name];
            lesson_index = 0;
            lesson_name = lesson_dropdown[0].text;
            refresh_dropdowns();
        }
    }
    else {
        contents["Courses"].splice(course_index, 1);
        delete contents[course_name];
        course_index = 0;
        course_name = lesson_dropdown[0].text;
        refresh_dropdowns();
        download();
    }
}

function selected_option(dropdown) {
    active_indexes["bar"] = [bar_dropdown, plates_dropdown][["bar","plates"].indexOf(dropdown)].selectedIndex;
}

function refresh_dropdowns() {
    while (bar_dropdown.options.length > 0) {                
        bar_dropdown.remove(0);
    } 
    while (plates_dropdown.options.length > 0) {                
        plates_dropdown.remove(0);
    }
    for (let n of Object.keys(contents["bar"])) {
        option = document.createElement("option");
        option.text = n;
        bar_dropdown.add(option);
    }
    for (let n of Object.keys(contents["plates"])) {
        option = document.createElement("option");
        option.text = n;
        plates_dropdown.add(option);
    }
    bar_dropdown.selectedIndex = active_indexes["bar"];
    plates_dropdown.selectedIndex = active_indexes["plates"];
}

function calculate_desired_weight() {
    let desired_weight = desired_wight_entry.value;
    if (!Number.isInteger(parseInt(desired_weight))) {
        plates_needed_text.innerHTML = "Please only include integer in desired weight (for now).";
        return;
    }
    let bar_used = contents["bar"][Object.keys(contents["bar"])[active_indexes["bar"]]];
    let plates_used = contents["plates"][Object.keys(contents["plates"])[active_indexes["plates"]]];
    let plates_needed = [];
    let weight_remaining = parseInt(desired_weight) - parseInt(bar_used.split(" ")[0]);
    for (let j = 0; j < plates_used.length; j++) {
        let plate = plates_used[j];
        let num_plates = Math.floor(weight_remaining/2/parseInt(plate.split(" ")[0]));
        console.log(weight_remaining, num_plates, plate);
        for (let i = 0; i < num_plates; i++) {
            plates_needed.push(plate);
            weight_remaining -= 2 * parseInt(plate.split(" ")[0]);
        }
    }
    plates_needed_text.innerHTML = plates_needed.join("<br/>");
}

let bar_dropdown = document.getElementById("bar_selection");
let plates_dropdown = document.getElementById("plates_selection");
let desired_wight_entry = document.getElementById("desired_weight");
let plates_needed_text = document.getElementById("plates_needed");

let contents = {
    "bar": {
        "Barbell": "45 lbs"
    },
    "plates": {
        "Iron Dungeon": [
            "45 lbs",
            "35 lbs",
            "25 lbs",
            "10 lbs",
            "5 lbs",
            "2.5 lbs",
            "1.5 lbs",
            "0.5 lbs"
        ]
    }
};

let active_indexes = {
    "bar": 0,
    "plates": 0
};

refresh_dropdowns();
        </script>
    </body>
</html>
